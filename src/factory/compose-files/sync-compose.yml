version: '3.3'

services:
  sync:
    image: couchbase/sync-gateway:2.6.1-community
    hostname: sync
    restart: always
    networks:
      - bfastweb
      - default
    ports:
      - 4984
    volumes:
      - ./my-sg-config.json:/tmp/config/my-sg-config.json
    command:
      - /tmp/config/my-sg-config.json
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
        condition: any
        delay: 2s
      resources:
        limits:
          memory: 125M
      labels:
        - "traefik.docker.network=bfastweb"
        - "traefik.enable=true"
        - "traefik.frontend.rule=Host:${projectId}-sync.bfast.fahamutech.com"
        - "traefik.port=4984"
        - "traefik.protocol=http"
  faas:
    image: joshuamshana/bfastfaas:v1.8.0
    hostname: ${projectId}-faas
    restart: always
    networks:
      - default
      - bfastweb
    deploy:
      resources:
        limits:
          memory: 125M
      restart_policy:
        condition: any
        delay: 2s
      labels:
        - "traefik.docker.network=bfastweb"
        - "traefik.enable=true"
        - "traefik.frontend.rule=Host:${projectId}-faas.bfast.fahamutech.com"
        - "traefik.port=3000"
        - "traefik.protocol=http"
    environment:
      - APPLICATION_ID=${appId}
      - PROJECT_ID=${projectId}
      - COUCHBASE_URL=http://cdb:8091/pools
networks:
  bfastweb:
    external: true
volumes:
